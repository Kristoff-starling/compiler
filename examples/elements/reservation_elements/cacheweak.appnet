state
{
	@consistency(weak) @combiner(sum) @persistence(true)
	cache: Map<string, string>
}

fn init() {
}


fn req(rpc_req) {
    res := cache.get(rpc_req.get('customer_name'));
	match (res) {
		Some(name) => {
            match (name) {
                'cached' => {
                    send(err('200'), Up);
                }
                _ => {
                    send(err('403'), Up);
                }
            };
		}
		None => {
			cache.set(rpc_req.get('customer_name'), 'cached');
			send(rpc_req, Down);
		}
	};
}

fn resp(rpc_resp) {
	send(rpc_resp, Up);
}
