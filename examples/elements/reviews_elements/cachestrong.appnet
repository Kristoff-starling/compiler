state
{
    @consistency(strong) @combiner(sum) @persistence(true)
	cache: Map<string, string>
}

fn init() {
}


fn req(rpc_req) {
    res := cache.get(rpc_req.get('user'));
	match (res) {
		Some(name) => {
            match (name) {
                'cached' => {
                    send(err('200'), Up);
                }
                _ => {
                    send(err('403'), Up);
                }
            };
		}
		None => {
			send(rpc_req, Down);
		}
	};
}

fn resp(rpc_resp) {
    key := rpc_resp.get('user');
	value := 'cached';
	cache.set(key, value);
	send(rpc_resp, Up);
}
